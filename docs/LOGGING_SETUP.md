# üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π UTF-8 –¥–ª—è Windows

## üéØ –û–±–∑–æ—Ä

–î–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è CRM —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ Windows.

## üö® –ü—Ä–æ–±–ª–µ–º–∞

–ù–∞ Windows —Å–∏—Å—Ç–µ–º–∞—Ö –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —ç–º–æ–¥–∑–∏:

```
UnicodeEncodeError: 'charmap' codec can't encode character '\U0001f510' in position 81
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–°–æ–∑–¥–∞–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã –≤ `core/logging_handlers.py`:

#### SafeUTF8FileHandler
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç–º–æ–¥–∑–∏ –≤ –ª–æ–≥-—Ñ–∞–π–ª–∞—Ö
- –ó–∞–º–µ–Ω—è–µ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫—É

#### ConsoleHandler
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∫—É –¥–ª—è Windows
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —ç–º–æ–¥–∑–∏

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ settings.py

```python
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è Windows
try:
    from core.logging_handlers import setup_windows_logging
    setup_windows_logging()
except ImportError:
    pass

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'formatters': {
        'verbose': {
            'format': '{levelname} {asctime} {module} {process:d} {thread:d} {message}',
            'style': '{',
        },
    },
    'handlers': {
        'file': {
            'level': 'INFO',
            'class': 'core.logging_handlers.SafeUTF8FileHandler',
            'filename': BASE_DIR / 'logs' / 'django.log',
            'formatter': 'verbose',
            'encoding': 'utf-8',
        },
        'alerts_file': {
            'level': 'WARNING',
            'class': 'core.logging_handlers.SafeUTF8FileHandler',
            'filename': BASE_DIR / 'logs' / 'alerts.log',
            'formatter': 'verbose',
            'encoding': 'utf-8',
        },
        'console': {
            'level': 'INFO',
            'class': 'core.logging_handlers.ConsoleHandler',
            'formatter': 'verbose',
        },
        'telegram': {
            'level': 'ERROR',
            'class': 'core.telegram_handler.TelegramLogHandler',
        },
    },
    'root': {
        'handlers': ['file', 'console'],
        'level': 'INFO',
    },
}
```

## üîß –ó–∞–º–µ–Ω–∞ —ç–º–æ–¥–∑–∏

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç —ç–º–æ–¥–∑–∏ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç—ã:

| –≠–º–æ–¥–∑–∏ | –ó–∞–º–µ–Ω–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------|----------|
| üîê | [LOGIN] | –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É |
| ‚è∞ | [TIME] | –í—Ä–µ–º—è |
| üìÑ | [DESC] | –û–ø–∏—Å–∞–Ω–∏–µ |
| üë§ | [USER] | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| üö® | [ERROR] | –û—à–∏–±–∫–∞ |
| ‚ö†Ô∏è | [WARNING] | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ |
| ‚úÖ | [SUCCESS] | –£—Å–ø–µ—Ö |
| ‚ùå | [FAIL] | –ù–µ—É–¥–∞—á–∞ |
| üí∞ | [MONEY] | –î–µ–Ω—å–≥–∏ |
| üìù | [NOTE] | –ó–∞–º–µ—Ç–∫–∞ |
| üîó | [LINK] | –°—Å—ã–ª–∫–∞ |
| üìã | [DETAILS] | –î–µ—Ç–∞–ª–∏ |
| ‚ÑπÔ∏è | [INFO] | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è |
| üì¢ | [ALERT] | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
python scripts/test_logging.py
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª—ã
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫—É Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫—É —ç–º–æ–¥–∑–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–≥-—Ñ–∞–π–ª–æ–≤

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥-—Ñ–∞–π–ª–æ–≤

```
logs/
‚îú‚îÄ‚îÄ django.log      # –û—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ alerts.log      # –õ–æ–≥–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –∏ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ mango_import.log # –õ–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∞ Mango
‚îî‚îÄ‚îÄ auto_import_mango.log # –õ–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏
tail -f logs/django.log

# –õ–æ–≥–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
tail -f logs/alerts.log

# –õ–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∞ Mango
tail -f logs/mango_import.log
```

### –ü–æ–∏—Å–∫ –ø–æ –ª–æ–≥–∞–º

```bash
# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
grep "ERROR" logs/django.log

# –ü–æ–∏—Å–∫ –ª–æ–≥–∏–Ω–æ–≤
grep "\[LOGIN\]" logs/django.log

# –ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
grep "\[USER\]" logs/django.log
```

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### Windows PowerShell

```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ UTF-8
chcp 65001

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
python manage.py runserver
```

### Windows Command Prompt

```cmd
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ UTF-8
chcp 65001

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
python manage.py runserver
```

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```env
# –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –¥–ª—è Python
PYTHONIOENCODING=utf-8

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
LOG_LEVEL=INFO
LOG_ENCODING=utf-8
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∫–ª—é—á–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

- ‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- üíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- üñ•Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ CPU
- üíø –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞

## üöÄ –ü—Ä–æ–¥–∞–∫—à–µ–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. **–†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤**
   ```python
   'handlers': {
       'file': {
           'class': 'logging.handlers.RotatingFileHandler',
           'maxBytes': 10*1024*1024,  # 10MB
           'backupCount': 5,
           'encoding': 'utf-8',
       }
   }
   ```

2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–æ–≤ –≤ ELK Stack
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Grafana
   - –ê–ª–µ—Ä—Ç—ã —á–µ—Ä–µ–∑ Telegram

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ª–æ–≥–æ–≤**
   - –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥-—Ñ–∞–π–ª–æ–≤
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. ‚úÖ –õ–æ–≥–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ –∫–æ–¥–∏—Ä–æ–≤–∫–∏
2. ‚úÖ –≠–º–æ–¥–∑–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–º–µ–Ω—è—é—Ç—Å—è
3. ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
4. ‚úÖ –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ —á–∏—Ç–∞–µ–º
5. ‚úÖ –õ–æ–≥-—Ñ–∞–π–ª—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞—Ö

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –õ–æ–≥–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
ls -la logs/

# –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –ª–æ–≥–æ–≤
mkdir -p logs
chmod 755 logs
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –≤ –ª–æ–≥–∞—Ö
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É —Ñ–∞–π–ª–∞
file logs/django.log

# –ü–µ—Ä–µ–∫–æ–¥–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª
iconv -f cp1251 -t utf-8 logs/django.log > logs/django_utf8.log
```

### –ü—Ä–æ–±–ª–µ–º–∞: Telegram –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo $TELEGRAM_BOT_TOKEN
echo $TELEGRAM_CHAT_ID

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
ping api.telegram.org
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Django Logging Documentation](https://docs.djangoproject.com/en/5.2/topics/logging/)
- [Python Logging HOWTO](https://docs.python.org/3/howto/logging.html)
- [Windows UTF-8 Support](https://docs.microsoft.com/en-us/windows/uwp/design/globalizing/use-utf8-code-page)

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 6 –∏—é–ª—è 2025 –≥.* 